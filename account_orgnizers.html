<!DOCTYPE html>
<html lang="en" xmlns:wb="http://open.weibo.com/wb" class="huodongxing">
  <head>
    <title></title>
    <meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <!-- Set render engine for 360 browser -->
    <link href="./static/css/hdx.css" rel="stylesheet" type="text/css" />
    <link href="./static/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="./static/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="./static/css/base.css" rel="stylesheet" type="text/css" />

    <!--[if lte IE 6]><link href="./static/css/ie6-fix.css" type="text/css" rel="stylesheet"><![endif]-->
    <!--[if IE 7]><link rel="stylesheet" type="text/css" href="./static/css/ie.css" /><![endif]-->

    <!--[if lt IE 9]><script type="text/javascript" src="./static/js/ie/html5.js"></script><![endif]-->

    <script src="./static/js/jquery/jquery.js" type="text/javascript"></script>
    <script src="./static/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="./static/js/com.js" type="text/javascript"></script>


    <link href="./static/css/user_page.min.css" rel="stylesheet" type="text/css" />
    <link href="./static/css/event-create.min.css" rel="stylesheet" type="text/css" />
    <style>
      .hdx-header{
        position: absolute;
      }
    </style>
    <script type="text/javascript" src="./static/js/jquery/jquery.validate.min.js"></script>
    <script type="text/javascript" src="./static/js/jquery/messages_cn.js"></script>
    <script type="text/javascript" src="./static/js/jquery/jquery.form.js"></script>

    <script type="text/javascript" src="./static/js/jquery/jquery.ui.widget.js"></script>
    <script type="text/javascript" src="./static/js/jquery/jquery.iframe-transport.js"></script>
    <script type="text/javascript" src="./static/js/jquery/jquery.fileupload.js"></script>
    <script type="text/javascript" src="./static/js/jquery/jquery.fileupload-fp.js"></script>
    <script type="text/javascript" src="./static/js/bootstrap/bootstrap-datepicker.js"></script>
    <script type="text/javascript" src="./static/js/jquery/ZeroClipboard.min.js"></script>
  </head>
  <body>
    <!--[if lte IE 6]><script src="./static/js/ie/warning.js"></script><script>window.onload=function(){e("./static/img/");}</script><![endif]-->

    <!-- Header/Navbar is here -->
    <script> util.topnav(); </script>



    <div class="user-page-new container-lg">
      <div class="alert fade in clear">
        <button type="button" class="icon-close-lg" data-dismiss="alert" aria-hidden="true"></button>
        温馨提醒：您可以添加多个主办方资料。什么是主办方？1. 主办活动的组织、团体或机构；您应该是其工作人员或拥有主办方活动冠名授权。 
        2. 主办方信息核实后才会显示在活动主页；对于没有添加主办方的活动将视为个人活动，仅在活动主页显示您的昵称。3. 在 活动管理->主办方设置 处可勾选多个主办方进行认证并设置为当前活动合办方。
      </div>
      <div class="user-main2">
        <div class="user-nav">
          <div class="avatar">
            <a href="http://www.huodongxing.com/user/index">
              <img src="http://qzapp.qlogo.cn/qzapp/100306609/15158C509654BB7A4AE0D9E772EBA691/30" alt="">iFlare
            </a>
          </div>
          <ul>
            <li><a href="./account_profile.html"><span class="icon-nav-user"></span>个人资料设置</a></li>
            <li><a href="./account_changepwd.html"><span class="icon-nav-password"></span>修改密码</a></li>
            <li><a href="./account_orgnizers.html"><span class="icon-event-org"></span>主办方资料</a></li>
            <li><a href="./account_payment.html"><span class="icon-event-price"></span>收款帐户设置</a></li>
            <li><a href="./account_invoice.html"><span class="icon-event-price"></span>发票信息设置</a></li>
          </ul>
        </div>
        <div class="content">
          <h1><a href="./userindex.html" class="text-primary pull-right small">返回我的活动行</a>主办方资料
          </h1>

          <div id="event-create-organizer">
            <button class="btn btn-create-add btn-create-add-primary">
              <span class="icon-ticket-add-primary"></span>添加主办方
            </button>
            <div class="event-create-form event-create-form-padding-lg" id="event-create-org-form01" style="display: none">
              <form action="/file/UploadOrgLogo" class="form-group" enctype="multipart/form-data" id="org_logo_upload_form" method="post">                        <input type="hidden" name="orgId" value="0" id="upfile_org_id"/>
                <label class="control-label">主办方图标</label>
                <div class="media event-create-poster">
                  <img id="event_org_logo_image" name="org_logo_upload_file" class="pull-left event-create-org-logo event-create-org-logo" src="./static/v2.0/img/event-create-org-logo-holder.png" alt="logo 尺寸：180*180 px"/>
                  <div class="media-body">
                    <div class="btn btn-primary btn-lg">
                      <span class="icon-btn-upload"></span>上传
                      <input id="org_logo_upload_file" name="org_logo_upload_file" type="file"/>
                    </div>
                    <div>
                      图片小于2M (jpg、gif、png、bmp)推荐尺寸 <em>360*360</em> px的图片！
                    </div>
                  </div>
                </div>
                  </form><form action="/myorg/SaveOrg" id="event_organization_form" method="post">                        <fieldset>
                  <input type="hidden" name="Id" value="0"/>
                  <input type="hidden" name="type" value="0"/>
                  <input type="hidden" name="act" value="0"/>
                  <input type="hidden" name="status" value="0"/>
                  <input type="hidden" name="Logo" value="" class="required"/>
                  <input type="hidden" name="theme" id="hidOrgTheme" value=""/>
                  <div class="form-group">
                    <label class="control-label">
                      主办单位名称<em>*</em></label>
                    <input name="Name" type="text" class="form-control event-create-form-control-block" maxlength="50" placeholder="限制50个字以内。">
                  </div>
                  <div class="form-group">
                    <label class="control-label">
                      联系人<em>*</em></label>
                    <input name="ContactName" type="text" class="form-control event-create-form-control-block" maxlength="30" placeholder="限制30个字以内。">
                  </div>
                  <div class="form-group">
                    <label class="control-label">
                      联系人手机<em>*</em></label>
                    <input name="ContactPhone" type="text" class="form-control event-create-form-control-block" maxlength="30">
                  </div>
                  <div class="form-group">
                    <label class="control-label">
                      联系人邮箱<em>*</em></label>
                    <input name="ContactEmail" type="text" class="form-control event-create-form-control-block" maxlength="64">
                  </div>
                  <div class="form-group">
                    <label class="control-label">
                      主办方简介<em>*</em></label>
                    <textarea name="Description" onclick=" this.select() " class="form-control event-create-form-control-block" maxlength="150" placeholder="限制150个字以内。"></textarea>
                  </div>
                  <div class="event-create-form-more">
                    <h3 class="">
                      <span class="icon-top-arrow-more"></span>完善更多信息
                    </h3>
                    <div class="form-group">
                      <label class="control-label">
                        专属网址</label>
                      <span class="text-muted">http://</span>
                      <input minlength="7" name="Subdomain" id="Subdomain" type="text" class="form-control" style="width: 100px;"/>
                      <span class="text-muted">.huodongxing.com</span>
                    </div>
                    <div class="form-group">
                      <label class="control-label">官方主页链接</label>
                      <input name="Homepage" type="text" class="form-control event-create-form-control-block">
                    </div>
                  </div>
                </fieldset>
                </form>                    <div class="text-center">
                <button class="pull-right btn btn-link" style="margin-top: 13px" onclick=" javascript:removeOrgs(); ">删除此主办方</button>
                <button class="btn btn-lg btn-primary" type="button" onclick=" javascript:$('#event_organization_form').submit();return false; ">确定</button>
                <button class="btn btn-lg btn-create-default">取消</button>
              </div>
            </div>
            <ul class="event-create-org-card" id="event-org-ul">

            </ul>
          </div>

        </div>
      </div>
    </div>


    <!-- Footer is here -->
    <script> util.footerhtml(); </script>



    <div class="modal fade modal-confirm" id="promo-modal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">操作提示</h4>
          </div>
          <div class="modal-body">
            <div style="margin-bottom: 10px;">关注 活动行 微信服务号</div>
            <img src="http://cdn.huodongxing.com/Content/v2.0/img/qr_normal.png" alt="">
            <div style="margin: 10px 0;">点击菜单 - 高级 - 推广合作</div>
            <img src="./static/v2.0/img/wechat_promo.jpg" alt="">
          </div>
        </div>
      </div>
    </div>
    <div class="feedback-layer modal fade" id="home_feedback_layer">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h4 class="modal-title">让批评和口水来的更猛烈些吧！</h4>
          </div>
          <div class="modal-body">

            <div class="feedback-face"></div>
            <form action="">
              <input class="form-control" type="text" placeholder="请输入您的邮箱/手机号" id="home_suggest_contact" max-length="64" value=""/>
              <textarea placeholder="在这里写下您想说的话。" id="home_suggest_content" max-length="512"></textarea>
              <div class="text-right">
                <button type="button" class="btn btn-link" data-dismiss="modal">取消</button><button type="button" class="btn btn-primary btn-lg" onclick="javascript:submitMySuggestion();">发送</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="bottom_tools" style="display:block;">
      <div class="qr_tool">
        二维码
      </div>
      <a id="feedback" href="#home_feedback_layer" data-toggle="modal" title="意见反馈">意见反馈</a>
      <a id="scrollUp" href="#" title="飞回顶部" style="display:none;"></a>
      <img class="qr_img fade hide" src="./static/v2.0/img/css/qr_img.png">
    </div>
    <div class="modal fade" id="pop_message_dlg" style="margin-top:250px;overflow-y:auto;z-index:10000">
      <div class="modal-dialog" style="width:550px;">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h4 class="modal-title" id="pop_msg_head"><span class="icon-danger" id="pop_message_icon"></span><span id="pop_message_content"></span></h4>
          </div>
        </div>
      </div>
    </div>

    <div id="jquery_ajax_loading" class="layer-warning modal" style="margin-top:250px;overflow-y:auto;">
      <div class="modal-dialog" style="width:450px;">
        <div class="modal-content">
          <div class="modal-body">
            <p><span class="icon-warning"></span> 页面正在加载中，请耐心等待...</p>
          </div>

        </div>
      </div>
    </div>
    <script type="text/javascript" src="./static/js/libs.min.js?v=v3.8.3"></script>

    <script type="text/javascript">
      var eventOrgsJson = null;
      var myOrgsJson = null;
      var eorg_validate = null;
      var currentCheckBox = null;

      function renderAllOrgs() {
        //我的主办方里列表里排除当前活动的主办方
        var otherOrgs = [];
        if (myOrgsJson != null && myOrgsJson.length > 0) {
          for (var i = 0; i < myOrgsJson.length; i++) {
            //判断是否应该添加
            var canAdd = true;
            if (eventOrgsJson != null && eventOrgsJson.length > 0) {
              for (var j = 0; j < eventOrgsJson.length; j++) {
                if (myOrgsJson[i].Id == eventOrgsJson[j].Id) {
                  //可能活动相关的主办方信息被修改了。
                  myOrgsJson[i] = eventOrgsJson[j];
                  canAdd = false;
                  break;
                }
              }
            }
            if (canAdd) {
              otherOrgs.push(myOrgsJson[i]);
            }
          }
        }
        var html = "";
        html += renderOrgHtml(eventOrgsJson, true);
        html += renderOrgHtml(otherOrgs, false);
        $('#event-org-ul').html(html);
      }

function renderOrgHtml(orgList, checked) {
  var dishtml = "";
  var html = "";
  if (orgList != null && orgList.length > 0) {
    for (var i = 0; i < orgList.length; i++) {
      var tmpItem = orgList[i];
      var orgUrl = tmpItem.SubdomainUrl && tmpItem.SubdomainUrl.length > 1 ? tmpItem.SubdomainUrl : '/org/' + tmpItem.Id;
      html += '<li oid="' + tmpItem.Id + '"' + '><a class="media event-create-checkbox"' + (tmpItem.Status == 1 ? 'href="' + orgUrl + '"' : "") + '>';
      if (tmpItem.Logo == null || $.trim(tmpItem.Logo) == "") {
        html += '<img class="pull-left" src="./static/v2.0/img/example/event-create-org-card.jpg" alt="" style="width:82px;height:82px;"/>';
      } else {
        html += '<img class="pull-left" src="/logo/' + tmpItem.Logo + '" alt="" style="width:82px;height:82px;"/>';
      }
      html += '<div class="media-body">';
      html += '<h3>' + tmpItem.Name + '</h3>';
      html += '<strong>&#9733;&nbsp;' + (tmpItem.Status == 1 ? '已认证' : (tmpItem.Status == 0 ? '未认证' : '已驳回')) + '</strong>';
      html += '<div class="text-muted">' + tmpItem.ContactName + '丨' + tmpItem.ContactEmail + '</div>';
      html += '</div></a><button class="icon-create-config" ' + dishtml + '></button><a ' + (tmpItem.Status == 1 ? 'href="' + orgUrl + '"' : "") + ' target="_blank" class="pull-right">主办方小站</a></li>';
    }
  }
  return html;
}

function removeOrgs()
{
  if($('#event_organization_form input[name=status]').val() == 1 && !confirm('主办方数据一经删除，不可恢复，是否确认删除？')) return;
  $('#event_organization_form input[name=status]').val(-1);
  $('#event_organization_form').submit();
  return false;
}

function getMyOrgs() {
  var eorgtab = $("#event-create-organizer");
  $.ajax({
url: '/myevent/listmyorgs',
type: "POST",
global: false,
success: function(data) {
if (data != null && data.AjaxErrStatus != null && data.AjaxErrStatus == 1) {
eorgtab.prepend('<p style="font-size:14px;padding:10px 25px;color:gray;">加载我的主办方出错，请刷新页面。</p>');
return;
}
myOrgsJson = data;
renderAllOrgs();
var oid = '';
if ($.trim(oid) != '') {
$("[oid='" + oid + "'] .icon-create-config").click();
}
},
error: function(XMLHttpRequest, textStatus, errorThrown) {
eorgtab.prepend('<p style="font-size:14px;padding:10px 25px;color:gray;">加载我的历史主办方出错，请刷新页面。</p>');
}
});
}

function selectPaymentType(type) {
  if (type == 0) {
    $("input[name='BankNo']").siblings('label').html('银行账号<em>*</em>');
    $("input[name='AccountName']").siblings('label').html('开户名称/姓名<em>*</em>');
    $("input[name='BankName']").parent().show();
    $("input[name='BranchName']").parent().show();
    $("#payment_bankcard_div").show();
  } else if (type == 1) {
    $("input[name='BankNo']").siblings('label').html('支付宝账号<em>*</em>');
    $("input[name='AccountName']").siblings('label').html('支付宝实名<em>*</em>');
    $("input[name='BankName']").val('');
    $("input[name='BranchName']").val('');
    $("input[name='BankName']").parent().hide();
    $("input[name='BranchName']").parent().hide();
    $("#payment_bankcard_div").hide();
    $("#payment_bankcard_file").val('');
  }
}

$('#event-create-organizer .btn-create-add-primary').on("click", function() {
    fillOutOrgInfo();
    });

$('#event-create-organizer .event-create-org-card').on("click", ".icon-create-config", function() {
    var orgId = $(this).parent().attr("oid");
    var orgJson = null;
    if (myOrgsJson != null && myOrgsJson.length > 0) {
    for (var i = 0; i < myOrgsJson.length; i++) {
    if (myOrgsJson[i].Id == orgId) {
    orgJson = myOrgsJson[i];
    break;
    }
    }
    }
    if (orgJson == null) {
    PopupMessage(1, "编辑主办方出现错误，请刷新页面请重新尝试！", 2000);
    return;
    }
    fillOutOrgInfo(orgJson);
    });
$("#event-create-organizer .event-create-org-card").on("change", "input[type=checkbox]", function() {
    var orgId = $(this).parent().parent().attr('oid');
    var orgJson = null;
    if (this.checked === true) {
    if (myOrgsJson != null && myOrgsJson.length > 0) {
    for (var i = 0; i < myOrgsJson.length; i++) {
    if (myOrgsJson[i].Id == orgId) {
    orgJson = myOrgsJson[i];
    break;
    }
    }
    }
    if (orgJson == null) {
    PopupMessage(1, "关联主办方出现错误，请刷新页面请重新尝试！", 2000);
    return;
    }
    fillOutOrgInfo(orgJson);
    $("#event_organization_form input[name='act']").val("0");
    $('#event_organization_form').submit();

    } else {
      if (eventOrgsJson != null && eventOrgsJson.length > 0) {
        for (i = 0; i < eventOrgsJson.length; i++) {
          if (eventOrgsJson[i].Id == orgId) {
            orgJson = eventOrgsJson[i];
            break;
          }
        }
      }
      if (orgJson == null) {
        PopupMessage(1, "移除主办方出现错误，请刷新页面请重新尝试！", 2000);
        return;
      }
      removeEventOrganization($(this), orgJson);
    }
});

function fillOutOrgInfo(orgJson) {
  $("#event_organization_form")[0].reset();
  if (orgJson == null) {
    $("#event_org_logo_image").prop("src", './static/v2.0/img/event-create-org-logo-holder.png');
    $("#event_organization_form input[name='Logo']").val("");
    $("#event_organization_form input[name='Id']").val("0");
    $("#event_organization_form input[name='type']").val("0");
    $("#event_organization_form input[name='act']").val("0");
    $("#event_organization_form input[name='status']").val("0");
    $("#event_organization_form input[name='theme']").val("");
  } else {
    $("#event_org_logo_image").prop("src", '/logo/' + orgJson.Logo);
    $("#event_organization_form input[name='Logo']").val(orgJson.Logo);
    $("#event_organization_form input[name='Id']").val(orgJson.Id);
    $("#event_organization_form input[name='type']").val("0");
    $("#event_organization_form input[name='act']").val("1");
    $("#event_organization_form input[name='status']").val(orgJson.Status);
    $("#event_organization_form input[name='theme']").val("");
    $("#event_organization_form input[name='Name']").val(orgJson.Name);
    $("#event_organization_form input[name='ContactName']").val(orgJson.ContactName);
    $("#event_organization_form input[name='ContactPhone']").val(orgJson.ContactPhone);
    $("#event_organization_form input[name='ContactEmail']").val(orgJson.ContactEmail);
    $("#event_organization_form textarea[name='Description']").text(orgJson.Description);
    $("#event_organization_form textarea[name='Description']").val(orgJson.Description);
    $("#event_organization_form input[name='Subdomain']").val(orgJson.Subdomain);
    $("#event_organization_form input[name='Homepage']").val(orgJson.Homepage);
  }
}

function deleteOrg()
{

}

$(function() {
    $('.event-create-form-more').on('click', 'h3', function(e) {
      $(e.delegateTarget).toggleClass('open');
      });

    $.validator.addMethod("regex", function(value, element, param) {
      return value.match(new RegExp("^" + param + "$"));
      });
    eorg_validate = $("#event_organization_form").validate({
rules: {
Subdomain: {
regex: "[A-Za-z0-9_\-]*"
},
Name: "required",
ContactName: "required",
ContactPhone: "required",
ContactEmail: "required",
Description: {
required: true,
},
},
messages: {
Subdomain: {
regex: '只能使用字母、数字、减号或下划线'
},
Name: "必填",
ContactName: "必填",
ContactPhone: "必填",
ContactEmail: "必填",
  Description: "必填"
  },
submitHandler: function(form) {
                 var logo = $("#event_organization_form input[name='Logo']").val();
                 if (logo == null || logo.length <= 0) {
                   PopupMessage(1, "请上传主办方图标！", 2000);
                   return;
                 }
                 var id = parseInt($("#event_organization_form input[name='Id']").val());
                 var status = parseInt($("#event_organization_form input[name='status']").val());
                 var act = parseInt($("#event_organization_form input[name='act']").val());
                 if (status == 1 && id > 0 && act == 1 && !window.confirm("本主办单位信息已被认证，提交后会重新进入认证审核流程，您确定要提交？")) {
                   return;
                 }
                 jQuery(form).ajaxSubmit({
success: function(data) {
if (data != null && data.AjaxErrStatus != null && data.AjaxErrStatus == 1) {
PopupMessage(1, "保存主办单位信息出错，原因：" + data.AjaxErrMsg, 5000);
setTimeout(function() {
  window.location = window.location;
  }, 5000);
return;
}
if (data != null && data === true) {
if($("#event_organization_form input[name='status']").val() == -1)
{ 
PopupMessage(0, '删除主办方信息成功', 3000);
}
else{
PopupMessage(0, '保存主办方信息成功', 3000);
}
} else if (data != null && data.length > 0) {
if($("#event_organization_form input[name='status']").val() == -1)
{ 
PopupMessage(0, '删除主办方信息成功', 3000);
}
else{
  PopupMessage(0, '保存主办方信息成功', 3000);
}
} else {
  if($("#event_organization_form input[name='status']").val() == -1)
  { 
    PopupMessage(0, '删除主办方信息成功', 3000);
  }
  else{
    PopupMessage(0, '保存主办方信息成功', 3000);
  }
}
setTimeout(function() {
    window.location = window.location;
    }, 3000);
},
error: function(XMLHttpRequest, textStatus, errorThrown) {
         //$('#dlg-organization-form').modal('hide');
         PopupMessage(1, "保存主办单位信息出错：服务不存在或无响应", 2000);
         setTimeout(function() {
             window.location = window.location;
             }, 2000);
       }
});
}
});
$('#org_logo_upload_form').fileupload({
autoUpload: true,
maxNumberOfFiles: 1,
maxFileSize: 200000,
pasteZone: null,
dropZone: null,
acceptFileTypes: /(\.|\/)(gif|jpe?g|png|bmp)$/i,
done: function(e, data) {
var result = "";
if (typeof(data.result) == 'string') result = $.trim(data.result);
else {
if (data.result[0] != null && data.result[0].activeElement != null) result = $.trim(data.result[0].activeElement.innerText);
}
if (result != null && result.indexOf("ERROR") >= 0) {
PopupMessage(1, "上传主办方图标出错，原因：" + result.substring(6), 2000);
} else {
if (result != null) result = result.replace(/\"/g, "");
if (result != null && result != '' && result != 'null') {
$("#event_org_logo_image").prop("src", '/logo/' + result);
$("#event_organization_form input[name='Logo']").val(result);
} else {
  PopupMessage(1, "上传主办方图标出错，请稍候重试。", 2000);
}
}
},
fail: function(e, data) {
        PopupMessage(1, "上传主办方图标出错，请稍候重试。", 2000);
      }
});

var $orgCard = $('.event-create-org-card');
var $orgForm = $('#event-create-organizer .event-create-form');
var offsetTop = $('.user-main2').offset().top
var toggleOrgCard = function() {
  $orgForm.toggle();
  $orgCard.toggle();
  return $(document).scrollTop(offsetTop);
};
window.toggleOrgCard = toggleOrgCard;
$orgCard.on('click', '.icon-create-config', toggleOrgCard);
$orgForm.find('.btn-create-default').click(toggleOrgCard);
$('#event-create-organizer .btn-create-add-primary').click(function() {
    if (!$orgForm.is(':visible')) {
    $orgForm.show();
    return $orgCard.hide();
    }
    });

$(function() {
    getMyOrgs();
    });
});
</script>

<script type="text/javascript">
  function submitMySuggestion(){
    var sContactVal = $("#home_suggest_contact").val();
    var sContentVal = $("#home_suggest_content").val();
    if(sContactVal == '' || sContentVal == '') return;
    $.ajax({
url: '/suggest',
type: "POST",
data: { "contact": sContactVal, "content": sContentVal, "token":"123BCD85A62AE727D0396B85267391B462FA04733FAF8577A5B7E89BA479831BC465FE459BD4FD1969" },
success: function (data) {
window.alert("我们已收到您反馈的意见，感谢对我们的支持。");
$("#home_feedback_layer").modal("hide");
}
});
}


+function ($) {
  var $window = $(window);
  var $body = $(document.body);
  var $navBar = $('.hdx-header');
  var headerHeight = $navBar.outerHeight(true);
  var $subNavBar = $('.sub_nav');
  $body.scrollspy({
target: '.intro-nav',
offset: headerHeight + 40
});
$window.on('load', function () { $body.scrollspy('refresh'); });

var $introNav = $('.intro-nav');
var $bottomTools = $('.bottom_tools');
var $qrTools = $('.qr_tool');
var qrImg = $('.qr_img');
$introNav
.affix({
offset:{
bottom:$('.page-footer').outerHeight()
}
})
.find('.nav > a').click(function (e) { e.preventDefault(); });

setTimeout(function () {
    $window.scroll(function () {
      var scrollHeight = $(document).height();
      var scrollTop = $window.scrollTop();
      var $footerHeight = $('.page-footer').outerHeight(true);
      var $windowHeight = $window.innerHeight();
      $window.scrollTop() > 50 ? $("#scrollUp").fadeIn(200) : $("#scrollUp").fadeOut(200);
      $bottomTools.css("bottom", scrollHeight - scrollTop - $footerHeight > $windowHeight ? 20 : $windowHeight + scrollTop + $footerHeight + 20 - scrollHeight);
      });
    $('#scrollUp').click(function (e) {
      e.preventDefault();
      $('html,body').animate({ scrollTop: 0 });
      });
    $qrTools.hover(function(){
      qrImg.removeClass('hide')
      $.support.transition ?
      qrImg
      .one($.support.transition.end, function(){
        qrImg.addClass('in')
        })
      .emulateTransitionEnd(150) :
      qrImg.addClass('in')
      },function(){
      qrImg.removeClass('in')
      $.support.transition ?
      qrImg
      .one($.support.transition.end, function(){
        qrImg.addClass('hide')
        }) :
      qrImg.addClass('hide')
      })
}, 500);
$('.hdx-header .search').on('click','li a',function(e){
    e.preventDefault();
    //var parent= $(this).parent().parent('.dropdown').find('span')[0].innerHTML;
    //var parent= $(this).parent().parent('.dropdown').find('span')[0].attr("str");
    var affiliation = $(this).attr("title");
    var current = $(this).attr("str");
    if(affiliation != current){
    $("#searchEventArea").toggle();
    $("#searchOrgArea").toggle();
    }
    });
$("#searchOrgArea button").bind("click", function () {
    var qs = $("#searchOrgArea input[type='text']").val();
    if (qs != null && qs != '') {
    window.location = '/zhubanfang/a?p=1' + encodeURI("&qs=" + qs);
    }
    });
$('.aside h2 .more').click(function(e){
    //e.preventDefault();
    if ($(this).hasClass('active')) return
    $(this).addClass('active');
    setTimeout($.proxy(function(){
        $(this).removeClass('active')
        },this),200)
    });
var $loginToggle = $('.icon-login-toggle');
var $iconLogins = $loginToggle.parent();
$loginToggle.on('mouseenter',function(){
    $iconLogins.toggleClass('fold')
    })
$iconLogins.on('mouseleave',function(){
    $iconLogins.addClass('fold')
    })
} (window.jQuery)

function addFavorite() {
  if (document.all) {
    try {
      window.external.addFavorite(window.location.href, document.title);
    } catch (e) {
      window.alert("对不起，您的浏览器不支持此操作！\n\r请您使用使用Ctrl+D收藏本站");
    }
  } else if (window.sidebar) {
    window.sidebar.addPanel(document.title, window.location.href, "");
  } else {
    window.alert("对不起，您的浏览器不支持此操作！\n\r请您使用使用Ctrl+D收藏本站");
  }
}
function forwardEmailLink(email) {
  if (email == null || email == "") return "";
  var emlower = email.toLowerCase();
  var link = "<a target='_blank' href='http://";
  if (emlower.indexOf("@qq.com") > 0 || emlower.indexOf("@163.com") > 0 || emlower.indexOf("@126.com") > 0 || emlower.indexOf("@tom.com") > 0 || emlower.indexOf("@sina.com") > 0 || emlower.indexOf("@yahoo.com") > 0) {
    link += "mail." + emlower.substring(emlower.indexOf("@") + 1);
  }
  else {
    link += "www." + emlower.substring(emlower.indexOf("@") + 1);
  }
  link += "'>前往查收</a>";
  return link;
}
function PopupMessage(type, msg, hideTime,backdrop){
  if(msg == null || msg == "" || type < 0) return;
  if(type == 0){
    type = 'icon-success'
  }else if(type == 'warning'){
    type = 'icon-warning'
  }else{
    type = 'icon-danger'
  }
  $("#pop_message_icon").removeClass("icon-danger icon-success icon-warning").addClass(type);
  $("#pop_message_content").html(msg);
  if(msg != null && msg.length <= 25){ $("#pop_msg_head").css("text-align","center"); }
  else{ $("#pop_msg_head").css("text-align","center"); }
  $('#pop_message_dlg').modal({show:true, backdrop:backdrop ? backdrop : false });
  if(hideTime != null && hideTime > 0) window.setTimeout(function () { $('#pop_message_dlg').modal('hide'); }, hideTime);
}
function setupScriptDelay(scriptPath, sync, onHead){
  var setupScript = document.createElement("script"); setupScript.type = 'text/javascript';
  if(!sync) setupScript.async = true;
  if(scriptPath.indexOf("http") == 0) setupScript.src = scriptPath;
  else setupScript.src = (("https:" == document.location.protocol) ? "https://" : "http://") + scriptPath;
  if(onHead) document.getElementsByTagName("head")[0].appendChild(setupScript);
  else document.body.appendChild(setupScript);
}


$(function () {
    $.ajaxSetup({ timeout: 45000 });
    $(document).ajaxStart(function () {
      var bgfi = $("div.modal-backdrop.in");
      if (bgfi != null && bgfi.length > 0) $('#jquery_ajax_loading').modal({ show: true, backdrop: false, keyboard: false });
      else $('#jquery_ajax_loading').modal({ show: true, backdrop: 'static', keyboard: false });
      }).ajaxSend(function(evt, request, settings) {
        console.log(settings.url);
        }).ajaxStop(function () {
          $('#jquery_ajax_loading').modal('hide');
          var bgfi = $("div.modal-backdrop.in");
          if (bgfi == null || bgfi.length == 0){ $("body").removeClass("modal-open"); }
          });
    window.setTimeout("setupGlobalScript()", 350);
    });
//var _bdhmProtocolExternal = (("https:" == document.location.protocol) ? " https://" : " http://");
//document.write(unescape("%3Cscript src='" + _bdhmProtocolExternal + "hm.baidu.com/h.js%3Fd89d7d47b4b1b8ff993b37eafb0b49bd' type='text/javascript'%3E%3C/script%3E"));
</script>

<script type="text/javascript" src="/iplookup"></script>
<script type="text/javascript">
  if(remote_ip_info != null){
    $("input[type=hidden][name='ex_country']").val(remote_ip_info.country);
    $("input[type=hidden][name='ex_province']").val(remote_ip_info.province);
    $("input[type=hidden][name='ex_city']").val(remote_ip_info.city);

    $("input[type=hidden][name='City']").val(remote_ip_info.city);
    $("input[type=hidden][name='Province']").val(remote_ip_info.province);
    $("input[type=hidden][name='Address']").val(remote_ip_info.province + "--" + remote_ip_info.city);

    $("input[type=hidden][name='country']").val(remote_ip_info.country);
    $("input[type=hidden][name='province']").val(remote_ip_info.province);
    $("input[type=hidden][name='city']").val(remote_ip_info.city);
    $("input[type=hidden][name='district']").val(remote_ip_info.district);

    var currentRegion = null;
    if (document.cookie.length > 0) {
      var regionstart = document.cookie.indexOf("HDX_REGION=");
      if (regionstart != -1){
        regionstart = regionstart + "HDX_REGION".length + 1;
        var regionend = document.cookie.indexOf(";", regionstart);
        if (regionend == -1) regionend = document.cookie.length;
        currentRegion = document.cookie.substring(regionstart, regionend);
      }
    }
    if((currentRegion == null || $.trim(currentRegion) == "") && remote_ip_info.city != null && $.trim(remote_ip_info.city) != ""){
      var regionExDate=new Date();
      regionExDate.setDate(regionExDate.getDate() + 365);
      document.cookie = "HDX_REGION=" + escape(remote_ip_info.province + "," + remote_ip_info.city) + ";domain=huodongxing.com;path=/;expires=" + regionExDate.toGMTString();
    }
  }
</script>

  </body>
</html>
